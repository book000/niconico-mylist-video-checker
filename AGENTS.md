# AI エージェント共通作業方針

## 目的

このファイルは、AI エージェントがこのプロジェクトで作業する際の共通作業方針を定義します。

## 基本方針

- **会話言語**: 日本語
- **コード内コメント**: 日本語
- **エラーメッセージ**: 英語
- **日本語と英数字の間**: 必ず半角スペースを挿入
- **コミット規約**: [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/) に従う
  - 形式: `<type>(<scope>): <description>`
  - `<description>` は日本語で記載
  - 例: `feat: Discord 通知機能を追加`

## 判断記録のルール

判断を行う際は、以下の項目を記録すること：

1. **判断内容の要約**: 何を決定したか
2. **検討した代替案**: 他にどのような選択肢があったか
3. **採用理由**: なぜその案を選んだか
4. **前提条件**: 判断の前提となる条件
5. **不確実性**: 不明確な点や仮定している点

**重要**: 仮定を事実のように扱わず、不確実性を明示すること。

## 開発手順（概要）

### 1. プロジェクト理解

- `README.md` と `README-ja.md` でプロジェクトの目的と機能を理解する
- `package.json` で技術スタックと開発コマンドを確認する
- `src/main.ts` でメイン処理フローを理解する

### 2. 依存関係インストール

```bash
pnpm install
```

### 3. 変更実装

- **コーディング規約**: Prettier と ESLint の設定に従う
- **TypeScript**: strict モード有効、`skipLibCheck` での回避禁止
- **docstring**: 関数やインターフェースに JSDoc を日本語で記載

### 4. テストと Lint/Format 実行

```bash
# Lint チェック
pnpm lint

# 自動修正
pnpm fix
```

## セキュリティ / 機密情報

- **Discord トークン**: `data/config.json` で管理し、Git にコミットしない
- **API キー**: 設定ファイルまたは環境変数で管理し、リポジトリにコミットしない
- **ログ出力**: 認証情報や個人情報を出力しない
- **コミット前**: センシティブな情報が含まれていないか必ず確認する

## リポジトリ固有

### プロジェクト概要

- **プロジェクト名**: niconico-mylist-video-checker
- **目的**: ニコニコ動画のマイリストから新しい動画を取得し、Discord に通知する
- **技術スタック**: TypeScript、Node.js、pnpm

### 主な機能

1. **マイリストデータ取得**: ニコニコ動画マイリスト API からデータを取得
2. **新規動画検出**: 既通知動画との差分を検出
3. **Discord 通知**: 新規動画を Discord に通知（Embed 形式）
4. **状態管理**: 通知済み動画 ID を `mylist.json` で管理

### 注意事項

- **Docker 実行**: 本番環境では Docker で実行される
- **設定ファイル**:
  - `data/config.json`: Discord 設定
  - `watch-my-lists.json`: 監視対象マイリスト ID リスト
  - `mylist.json`: 通知済み動画 ID 管理
- **環境変数**:
  - `WATCH_MY_LISTS_PATH`: 監視対象マイリストファイルのパス
  - `MY_LIST_PATH`: 通知済み動画管理ファイルのパス
- **初回実行**: `mylist.json` が存在しない場合は初期化モード（通知スキップ）
- **絵文字の使用**: ログやエラーメッセージには絵文字を使用（❌、🆕、🎥 等）
- **Renovate**: 依存関係の自動更新に使用。Renovate PR には変更を加えない

### 開発コマンド

```bash
# アプリケーション起動
pnpm start

# 開発モード
pnpm dev

# Lint 実行
pnpm lint

# 自動修正
pnpm fix
```

### ドキュメント更新

機能追加や使い方の変更時は、以下のドキュメントを更新すること：

- `README.md`
- `README-ja.md`
